name: Docker Build
on:
  workflow_dispatch:
  push:
    paths:
      - '.docker/**'
      - '.github/workflows/docker_build.yaml'
  workflow_run:
    workflows: ["Docker Build Base"]
    types: [completed]

jobs:
  docker-build-external-repos:
    runs-on: ubuntu-latest
    # if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'succcess'
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Get docker tag prefix
        id: docker-tag
        uses: JafarAbdi/docker-tag-prefix-action@main
      - run: echo "picknikciuser/moveit-studio:${{ steps.docker-tag.outputs.prefix}}external-repos"
      - env:
          GITHUB_CONTEXT: ${{ toJSON(github) }}
        run: echo "$GITHUB_CONTEXT"
  docker-build-moveit-studio:
    runs-on: ubuntu-latest
    needs: docker-build-external-repos
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Get docker tag prefix
        id: docker-tag
        uses: JafarAbdi/docker-tag-prefix-action@main
      - run: echo "picknikciuser/moveit-studio:${{ steps.docker-tag.outputs.prefix }}moveit-studio"

